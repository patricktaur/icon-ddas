<div class="row">
	<div class="col-lg-12">
		<div class="well">
			<h3 class="no-margin-top">Due Diligence Search</h3>
			<br> 
			<div class="row text-left">

				<div class="col-md-8">

					<button type="button" class="btn-lg btn-primary" (click)="OpenNew()" title="Create a new Investigator Compliance Form">Manual Search</button>

					<button type="button" class="btn-lg btn-primary" (click)="UploadComplianceFormInputsModal.open()" title="Upload an excel file with Compliance Form details. Compliance Forms and search results will be created.">Batch Upload</button>

				</div>
				<div class="col-md-4 ">

					<div class="text-right vertical-center">
						<a href="{{downloadTemplateUrl}}" download title="Download a sample/template file to fill in the Compliance Form Details and then upload with Due Diligence Check (Upload)"> Batch Upload Template</a>


					</div>

				</div>
			</div>

		</div>
	</div>
</div>

<div class="table-responsive">
<div statusCircle-Legend-Horizontal></div>
	<table class="table table-bordered table-hover table-striped">
		<thead>

			<tr>
				<th class="col-md-3 text-left">Principal Investigator </th>
				<th class="col-md-2 text-left">ICON Project Number</th>
				<th class="col-md-1 text-left">Sponsor Protocol Number</th>
				<th class="col-md-2 text-left">Country</th>
				<th class="col-md-1 text-center">Searched on</th>
				<th class="col-md-1 text-left">Status</th>
				<th class="col-md-2 text-center">Actions</th>
			</tr>
		</thead>

		<tbody>
			<tr *ngFor="let item of filteredRecords | paginate: { itemsPerPage: 10, currentPage: pageNumber}" class="active">

				<td class="text-left">
					{{item.Name}}
				</td>
				<td class="text-center">
					{{item.ProjectNumber}}
				</td>
				<td>
					{{item.SponsorProtocolNumber}}
				</td>
				<td class="text-left">
					{{item.Country}}

				</td>
				<td class="text-left">
					{{item.SearchStartedOn | date: 'dd/MMM/yyyy'}}

				</td>
				<td align="center">
					<div statusCircle [status]="item.StatusEnum" size=24 [title]="item.Status"></div>
				</td>
				<td>

					<button type="button" class="btn btn-primary" (click)="DownloadComplianceFormModal.generate(item.RecId,  'Principal Investigator: ' + item.Name)"
						title="Download Compliance Form"><span class="glyphicon glyphicon-download-alt" ></span></button>


					<button type="button" class="btn btn-primary" (click)="OpenForEdit(item)" title="Edit Compliance Form"><span class="glyphicon glyphicon-edit" ></span></button>
				</td>
			</tr>
		</tbody>
	</table>
	<pagination-controls (pageChange)="pageNumber = $event"></pagination-controls>
</div>

<modal #UploadComplianceFormInputsModal>
	<modal-header [show-close]="true">
		<h4 class="modal-title">Upload file</h4>
	</modal-header>
	<modal-body>
		<form>
			<div class="form-group">
				<div *ngIf="!validationMessage">
					<label for="fileupload">Upload a file - (.xlsx file with data to create compliance forms.)</label>
					<input type="file" id="fileupload" ngFileSelect [options]="basicOptions" (onUpload)="handleUpload($event)" class="form-control"
						name="Upload">
				</div>
				<div *ngIf="Loading">
					<p class="help-block">Uploading and Processing will take a while... </p>
					<p class="help-block">You can close this Window if you wish to continue with other activities.</p>
					<p class="help-block">The process will continue in the background.</p>
				</div>

				<div *ngIf="validationMessage">
					<p class="text-danger">The uploaded file has invalid data:</p>
					{{validationMessage}}
					<!--<p class="help-block" *ngFor="let message of validationMessages">{{message}}</p>-->
					<p class="text-danger">Correct and reload.</p>
				</div>
			</div>
		</form>
	</modal-body>
	<modal-footer>
		<button type="button" class="btn btn-default" (click)="UploadFile(); UploadComplianceFormInputsModal.close()">Close</button>
	</modal-footer>
</modal>

<div #DownloadComplianceFormModal download-compliance-form></div>